@using DigitalLearningSolutions.Web.ViewModels.Frameworks;
@model PublishViewModel;
@{
  ViewData["Title"] = Model.BaseFramework.FrameworkName;
  ViewData["Application"] = "Framework Service";
}
@section NavBreadcrumbs {
  <nav class="nhsuk-breadcrumb" aria-label="Breadcrumb">
    <div class="nhsuk-width-container">
      <ol class="nhsuk-breadcrumb__list">
        <li class="nhsuk-breadcrumb__item"><a class="nhsuk-breadcrumb__link trigger-loader" asp-action="FrameworksDashboard">Frameworks</a></li>
        <li class="nhsuk-breadcrumb__item"><a class="nhsuk-breadcrumb__link trigger-loader" asp-action="ViewFramework" asp-route-frameworkId="@Model.BaseFramework.ID" asp-route-tabname="Structure">Framework Structure</a></li>
        <li class="nhsuk-breadcrumb__item">Publish</li>
      </ol>
      <p class="nhsuk-breadcrumb__back"><a class="nhsuk-breadcrumb__backlink" asp-action="ViewFramework" asp-route-frameworkId="@Model.BaseFramework.ID" asp-route-tabname="Structure">Back to framework structure</a></p>
    </div>
  </nav>
}
<h1>Publish framework</h1>
@if (Model.FrameworkReviews.Any())
{
  <table role="table" class="nhsuk-table-responsive">
    <caption class="nhsuk-table__caption">Framework review status</caption>
    <thead role="rowgroup" class="nhsuk-table__head">
      <tr role="row">
        <th role="columnheader" class="" scope="col">
        Reviewer
        </th>
        <th role="columnheader" class="" scope="col">
          Requested
        </th>
        <th role="columnheader" class="" scope="col">
          Status
        </th>
        <th role="columnheader" class="" scope="col">
          Actions
        </th>
      </tr>
    </thead>
    <tbody class="nhsuk-table__body">
      @foreach (var review in Model.FrameworkReviews)
      {
        <tr role="row" class="nhsuk-table__row">
          <td role="cell" class="nhsuk-table__cell nhsuk-u-font-size-16">
            <span class="nhsuk-table-responsive__heading">Reviewer </span>@review.UserEmail
          </td>
          <td role="cell" class="nhsuk-table__cell nhsuk-u-font-size-16">
            <span class="nhsuk-table-responsive__heading">Requested </span>@review.ReviewRequested.ToShortDateString()
          </td>
          <td role="cell" class="nhsuk-table__cell nhsuk-u-font-size-16">
            <span class="nhsuk-table-responsive__heading">Status </span>
            <partial name="Shared/_ApprovalTag" model="review" />
          </td>
          <td role="cell" class="nhsuk-table__cell nhsuk-u-font-size-16">
            <span class="nhsuk-table-responsive__heading">Actions </span>
            @if (review.FrameworkCommentID != null)
            {
              <text>
                <a asp-action="ViewThread"
                   asp-controller="Frameworks"
                   asp-route-frameworkId="@Model.BaseFramework.ID"
                   asp-route-commentId="@review.FrameworkCommentID">
                  View comment
                </a>
                &nbsp;
              </text>
            }
            @if (review.ReviewComplete == null)
            {
              <a asp-action="ResendRequest" asp-route-reviewId="@review.ID">
                Resend request
              </a>
            }
            else if (!review.SignedOff)
            {
              <a asp-action="RequestReReview" asp-route-reviewId="@review.ID">
                Request Re-review
              </a>
            }
          </td>
        </tr>
      }
    </tbody>
  </table>
}
<div class="nhsuk-grid-row nhsuk-u-margin-top-3">
  <div class="nhsuk-grid-column-full">
    <a role="button" asp-action="SendForReview" asp-route-frameworkId="@Model.BaseFramework.ID" class="nhsuk-button nhsuk-button--secondary">Invite more reviewers</a>
  </div>
</div>

