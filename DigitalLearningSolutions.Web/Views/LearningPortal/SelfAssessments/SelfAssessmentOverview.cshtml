@using DigitalLearningSolutions.Web.ViewModels.LearningPortal
@using DigitalLearningSolutions.Web.ViewModels.LearningPortal.SelfAssessments
@model SelfAssessmentOverviewViewModel

@{
  Layout = "SelfAssessments/_Layout";
  ViewData["Title"] = "Self Assessment";
  ViewData["SelfAssessmentTitle"] = @Model.SelfAssessment.Name;
}
@section breadcrumbs {
  <li class="nhsuk-breadcrumb__item">Self Assessment</li>
}
<link rel="stylesheet" href="@Url.Content("~/css/learningPortal/selfAssessment.css")" asp-append-version="true">
<h1>@Model.SelfAssessment.Name - Overview</h1>

@if (Model.CompetencyGroups.Any())
{
  foreach (var competencyGroup in Model.CompetencyGroups)
  {
<div class="nhsuk-panel competency-group-panel">
  <details class="nhsuk-details nhsuk-expander">
    <summary class="nhsuk-details__summary">
      <span class="competency-group-title nhsuk-details__summary-text">
        @competencyGroup.Key
      </span>
    </summary>
    <div class="nhsuk-details__text">
      <partial name="SelfAssessments/_MeanScores"
               view-data="@(new ViewDataDictionary(ViewData) { { "competencyGroup", competencyGroup } })" />
      <table role="table" class="nhsuk-table-responsive nhsuk-u-margin-top-4">
        @*<caption class="nhsuk-table__caption"><h3>@competencyGroup.Key</h3></caption>*@
        <thead role="rowgroup" class="nhsuk-table__head">
          <tr role="row">
            <th role="columnheader" class="" scope="col">
              @competencyGroup.First().Vocabulary
            </th>
            <th role="columnheader" class="" scope="col">
              Question
            </th>
            <th role="columnheader" class="" scope="col">
              Response
            </th>
            <th role="columnheader" class="" scope="col">
              Status
            </th>
            <th role="columnheader" class="" scope="col">
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="nhsuk-table__body">
          @foreach (var competency in competencyGroup)
          {
            <tr role="row" class="nhsuk-table__row first-row">
              <td role="cell" rowspan="@competency.AssessmentQuestions.Count()" class="nhsuk-table__cell nhsuk-u-font-size-16">
                <a asp-action="SelfAssessmentCompetency" asp-route-selfAssessmentId="@Model.SelfAssessment.Id" asp-route-competencyNumber="@competency.RowNo">
                  <span class="nhsuk-table-responsive__heading">@competency.Vocabulary </span>@competency.Name
                </a>
              </td>
              <partial name="Shared/_AssessmentQuestionOverviewCells" model="competency.AssessmentQuestions.First()" />
              <td role="cell" class="nhsuk-table__cell nhsuk-u-font-size-16">
                <span class="nhsuk-table-responsive__heading">Actions </span>

              </td>
            </tr>
            @foreach (var question in competency.AssessmentQuestions.Skip(1))
            {
              <tr role="row" class="nhsuk-table__row">
                <partial name="Shared/_AssessmentQuestionOverviewCells" model="question" />
                <td role="cell" class="nhsuk-table__cell nhsuk-u-font-size-16">
                  <span class="nhsuk-table-responsive__heading">Actions </span>

                </td>
              </tr>

            }
          }
        </tbody>
      </table>
    </div>

  </details>
  <div class="outer-score-container">
    <partial name="SelfAssessments/_MeanScores"
             view-data="@(new ViewDataDictionary(ViewData) { { "competencyGroup", competencyGroup } })" />
    </div>

  </div>
  }
  }

  @if (Model.SelfAssessment.UseFilteredApi)
  {
    <p class="nhsuk-u-reading-width">Once you are happy with your responses, submit your self-assessment to retrieve a list of recommended learning resources.</p>
    <a class="nhsuk-button finish-review-button trigger-loader" asp-route-selfAssessmentId="@Model.SelfAssessment.Id" asp-action=@(Model.SelfAssessment.UnprocessedUpdates ? "SelfAssessmentFilteredResults" : "FilteredRecommendations")>
      Submit self assessment
    </a>
  }
