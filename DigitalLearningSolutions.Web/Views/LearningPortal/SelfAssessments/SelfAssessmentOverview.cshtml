@using DigitalLearningSolutions.Web.ViewModels.LearningPortal
@using DigitalLearningSolutions.Web.ViewModels.LearningPortal.SelfAssessments
@model SelfAssessmentOverviewViewModel

@{
  Layout = "SelfAssessments/_Layout";
  ViewData["Title"] = "Self Assessment";
  ViewData["SelfAssessmentTitle"] = @Model.SelfAssessment.Name;
}
@section breadcrumbs {
  <li class="nhsuk-breadcrumb__item"><a class="nhsuk-breadcrumb__link" asp-action="SelfAssessment" asp-route-selfAssessmentId="@Model.SelfAssessment.Id">Self Assessment</a></li>
  <li class="nhsuk-breadcrumb__item">Overview</li>
}
<link rel="stylesheet" href="@Url.Content("~/css/learningPortal/selfAssessment.css")" asp-append-version="true">
<h1>@Model.SelfAssessment.Name - Overview</h1>
@if (Model.SelfAssessment.IsSupervised)
{
  <a class="nhsuk-button nhsuk-button--secondary trigger-loader" asp-route-selfAssessmentId="@Model.SelfAssessment.Id" asp-route-vocabulary="@Model.CompetencyGroups.FirstOrDefault().First().Vocabulary.ToLower()" asp-action="StartRequestVerification">
    Request @Model.CompetencyGroups.FirstOrDefault().First().Vocabulary.ToLower() verification
  </a>
}
@if (Model.CompetencyGroups.Any())
{
  foreach (var competencyGroup in Model.CompetencyGroups)
  {
    @if (Model.SelfAssessment.LinearNavigation)
    {
      <div class="nhsuk-panel competency-group-panel">
        <details class="nhsuk-details nhsuk-expander">
          <summary class="nhsuk-details__summary">
            <span class="competency-group-title nhsuk-details__summary-text">
              @competencyGroup.Key
            </span>
          </summary>
          <div class="nhsuk-details__text">
            <partial name="SelfAssessments/_MeanScores"
                     view-data="@(new ViewDataDictionary(ViewData) { { "competencyGroup", competencyGroup } })" />

            <partial name="SelfAssessments/_OverviewTable" view-data="@(new ViewDataDictionary(ViewData) { { "linearNavigation", Model.SelfAssessment.LinearNavigation } })" model="competencyGroup" />

          </div>
        </details>
        <div class="outer-score-container">
          <partial name="SelfAssessments/_MeanScores"
                   view-data="@(new ViewDataDictionary(ViewData) { { "competencyGroup", competencyGroup } })" />
        </div>
      </div>
    }
    else
    {
      <div class="nhsuk-grid-row nhsuk-u-margin-bottom-4">
        <div class="nhsuk-grid-column-full">
          <partial name="SelfAssessments/_OverviewTable" view-data="@(new ViewDataDictionary(ViewData) { { "linearNavigation", Model.SelfAssessment.LinearNavigation } })" model="competencyGroup" />
        </div>
      </div>

    }
  }
}

@if (Model.SelfAssessment.UseFilteredApi)
{
  <p class="nhsuk-u-reading-width">Once you are happy with your responses, submit your self-assessment to retrieve a list of recommended learning resources.</p>
  <a class="nhsuk-button finish-review-button trigger-loader" asp-route-selfAssessmentId="@Model.SelfAssessment.Id" asp-action=@(Model.SelfAssessment.UnprocessedUpdates ? "SelfAssessmentFilteredResults" : "FilteredRecommendations")>
    Submit self assessment
  </a>
}
