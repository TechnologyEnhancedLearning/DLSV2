@using DigitalLearningSolutions.Web.ViewModels.LearningPortal.Current
@model CompetencySelfAssessmentCertificateViewModel
@{
    var errorHasOccurred = !ViewData.ModelState.IsValid;
    ViewData["Title"] = "Competency Self Assessment Certificate";
    var sumVerifiedCount = ((IEnumerable<dynamic>)ViewBag.CompetencySummaries).Sum(item => item.VerifiedCount);
    var sumQuestions = ((IEnumerable<dynamic>)ViewBag.CompetencySummaries).Sum(item => item.Questions);
}
<link rel="stylesheet" href="@Url.Content("~/css/learningPortal/selfassessmentcertificate.css")" asp-append-version="true">
<style>
    .nhsuk-breadcrumb {
        background-color: #f0f4f5;
        padding: 0 0;
    }

    .nhsuk-width-container {
        margin: 0;
    }

    li:last-child, .nhsuk-list > li:last-child {
        margin-bottom: 0;
        margin-left: -10px;
    }

    .nhsuk-grid-column-full {
        box-sizing: border-box;
        padding: 0 0;
    }

    .nhsuk-breadcrumb__link:visited {
        color: #330072;
        background-color: #f4f4f4;
        border-top: 2px solid blue;
        margin-left: -10px;
    }

    .pagebreak {
        page-break-before: always;
    }

</style>


@section NavMenuItems {
    <partial name="Shared/_NavMenuItems" />
}

<nav class="nhsuk-breadcrumb" aria-label="Breadcrumb">
    <div class="nhsuk-width-container">
        <ol class="nhsuk-breadcrumb__list">
            @if (Model.Route == 1)
            {
                <li class="nhsuk-breadcrumb__item"><a class="nhsuk-breadcrumb__link trigger-loader " asp-controller="LearningPortal" asp-action="Current">&lt; Back  </a></li>
            }
            @if (Model.Route == 2)
            {
                <li class="nhsuk-breadcrumb__item">
                    <a class="nhsuk-breadcrumb__link trigger-loader " asp-controller="LearningPortal"
                       asp-action="SelfAssessmentOverview" asp-route-vocabulary="@Model.VocabPlural"
                       asp-route-selfAssessmentId="@Model.CompetencySelfAssessmentCertificates.SelfAssessmentID">
                        &lt; Back
                    </a>
                </li>
            }
            @if (Model.Route == 3)
            {
                <li class="nhsuk-breadcrumb__item">
                    <a class="nhsuk-breadcrumb__link trigger-loader" asp-controller="Supervisor"
                       asp-action="ReviewDelegateSelfAssessment"
                       asp-route-supervisorDelegateId="@ViewBag.LoggedInSupervisorDelegatesId"
                       asp-route-candidateAssessmentId="@Model.CompetencySelfAssessmentCertificates.CandidateAssessmentID">
                        &lt; Back
                    </a>
                </li>

            }
        </ol>
    </div>
</nav>
<br />
<div class="nhsuk-width-container">
    <div class="nhsuk-grid-row">
        <div class="nhsuk-grid-column-full">
            <h1>Certificate</h1>

            <h2>@Model.CompetencySelfAssessmentCertificates.SelfAssessment - @Model.CompetencySelfAssessmentCertificates.LearnerName </h2>

            <a class="nhsuk-button "
               asp-route-candidateAssessmentId="@Model.CompetencySelfAssessmentCertificates.CandidateAssessmentID"
               asp-action="DownloadCertificate"
               role="button">
                Download certificate
            </a>
        </div>
    </div>
</div>
<div class="certificate">
    <div class="pg-1">
        <div class="head">
            <div class="logo">
                <svg class="certificate__logo" width="150" height="60" viewBox="0 0 100 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100" height="40" fill="#005EB8">
                    </rect>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0 0V40H100V0H0ZM22.4 36L15.7 13.9H15.6L11.1 36H3L9.9 4H20.7L27.3 26.2H27.4L31.9 4H40L33.2 36H22.4ZM55.7 36L58.5 22.3H48.4L45.6 36H37L43.7 4H52.3L49.8 16.2H60L62.4 4H71L64.3 36H55.7ZM93.9 10.8C92.2 10 89.9 9.3 86.7 9.3C83.2 9.3 80.4 9.8 80.4 12.4C80.4 16.9 93.1 15.2 93.1 24.9C93.1 33.7 84.7 36 77.1 36C73.7 36 69.8 35.2 67 34.3L69.1 27.8C70.8 28.9 74.3 29.6 77.2 29.6C79.9 29.6 84.2 29.1 84.2 25.8C84.2 20.7 71.5 22.6 71.5 13.6C71.4 5.5 78.8 3 86 3C90 3 93.8 3.4 96 4.4L93.9 10.8Z" fill="white">
                    </path>
                </svg>
            </div>

            <div class="text">
                <h1 class="certificate__heading">
                    <div class="nhsuk-u-margin-bottom-7">
                        <span class="nhsuk-body-m nhsuk-u-font-weight-normal nhsuk-u-margin-bottom-0">
                            This is to certify that
                        </span>
                        @Model.CompetencySelfAssessmentCertificates.LearnerName
                        <span class="nhsuk-body-m nhsuk-u-font-weight-normal nhsuk-u-margin-top-1">
                            @Model.CompetencySelfAssessmentCertificates.LearnerPRN
                        </span>
                    </div>
                    <div>
                        <span class="nhsuk-body-m nhsuk-u-font-weight-normal nhsuk-u-margin-bottom-0">
                            has successfully completed the
                        </span>
                        @Model.CompetencySelfAssessmentCertificates.SelfAssessment
                    </div>
                </h1>
                <p>
                    Signed off at @Model.CompetencySelfAssessmentCertificates.SupervisorCentreName <span class="nhsuk-body-m nhsuk-u-font-weight-normal nhsuk-u-margin-bottom-0">by @Model.CompetencySelfAssessmentCertificates.SupervisorName </span><span class="nhsuk-body-m nhsuk-u-font-weight-normal nhsuk-u-margin-bottom-0">@Model.CompetencySelfAssessmentCertificates.SupervisorPRN</span>
                </p>

                <p>
                    on @Model.CompetencySelfAssessmentCertificates.FormattedDate
                </p>
            </div>

            <div class="fancy-box"></div>
        </div>

        <div class="body">
            <h3 class=" nhsuk-u-margin-bottom-3">
                Including the following optional proficiencies:
            </h3>
            @foreach (var entry in Model.CompetencyCountSelfAssessmentCertificate)
            {
                <p class="nhsuk-u-margin-bottom-2 nhsuk-body-s">
                    @entry.CompetencyGroup - @entry.OptionalCompetencyCount
                    @if (@entry.OptionalCompetencyCount == 1)
                    {
                        @Model.CompetencySelfAssessmentCertificates.Vocabulary
                    }
                    else
                    {
                        @Model.VocabPlural
                    }

                </p>

            }

        </div>

        <div class="footer">
            <div class="text">
                <p class="blue">Certificate generated on @DateTime.Now.ToString("dd/MM/yyyy")</p>
                <p>By NHS England Digital Learning Solutions <br /> on behalf of @Model.CompetencySelfAssessmentCertificates.SupervisorCentreName</p>
            </div>
            <div class="footer-logo">
                @if (Model.CompetencySelfAssessmentCertificates.BrandImage != null)
                {
                    <img id="Logo" src="data:image;base64,@Convert.ToBase64String(Model.CompetencySelfAssessmentCertificates.BrandImage)" alt="Brand Logo Image" />
                }
                else
                {
                    <img src="https://www.hee.nhs.uk/sites/default/files/styles/image_658_witdh/public/Capital-Nurse-Logo.jpg?itok=8hlRIj8r" alt="Brand Logo Image" />
                }
            </div>
        </div>

        <div class="strips">
            <div class="strip-green"></div>
            <div class="strip-blue"></div>
        </div>
    </div>
    <br /><br />
    <div class="pg-2">
        <div class="body">
            <h2>Activity summary report</h2>
            <br />
            <div class="activity">
                <p><b>Activity: </b>@Model.CompetencySelfAssessmentCertificates.SelfAssessment</p>
            </div>
            <div class="activity">
                <p><b>Name: </b>@Model.CompetencySelfAssessmentCertificates.LearnerName</p>
            </div>
            <div class="activity">
                <p><b>Professional Registration Number: </b>@Model.CompetencySelfAssessmentCertificates.LearnerPRN</p>
            </div>
            <div class="activity">
                <p><b>Assessment question responses</b></p> <p>
                    @sumQuestions
                </p>
            </div>
            <div class="activity">
                <p><b>Responses meeting role requirements</b></p> <p>
                    @Model.RoleCount
                </p>
            </div>
            <div class="activity">
                <p><b>Responses confirmed by assessor</b></p> <p>
                    @sumVerifiedCount
                </p>
            </div>
            <div class="activity">
                <p><b>Assessors</b></p><ul>
                    @foreach (var accessor in Model.Accessors)
                    {
                        <p>
                            @accessor.AccessorList
                        </p>

                    }
                </ul>
            </div>
            <div class="activityline">
                <p><b>Signed Off By</b></p>
                @if (string.IsNullOrEmpty(@Model.CompetencySelfAssessmentCertificates.SupervisorPRN))
                {
                    <p>
                        @Model.CompetencySelfAssessmentCertificates.SupervisorName
                    </p>
                }
                else
                {
                    <p>
                        @Model.CompetencySelfAssessmentCertificates.SupervisorName, @Model.CompetencySelfAssessmentCertificates.SupervisorPRN
                    </p>
                }
            </div>
        </div>
        <p class="foot-note">Certificate generated on @DateTime.Now.ToString("dd/MM/yyyy")</p>
    </div>
</div>
