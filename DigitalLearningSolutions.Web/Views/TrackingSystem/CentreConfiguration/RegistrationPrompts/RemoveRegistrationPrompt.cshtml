@inject IConfiguration Configuration
@using DigitalLearningSolutions.Web.ViewModels.TrackingSystem.CentreConfiguration
@using Microsoft.Extensions.Configuration
@model RemoveRegistrationPromptViewModel

@{
  var errorHasOccurred = !ViewData.ModelState.IsValid;
  ViewData["Title"] = errorHasOccurred ? "Error: Remove delegate registration prompt" : "Remove delegate registration prompt";
  ViewData["Application"] = "Tracking System";
  ViewData["HeaderPath"] = $"{Configuration["AppRootPath"]}/TrackingSystem/Centre/Dashboard";
  ViewData["HeaderPathName"] = "Tracking System";
  var confirmError = ViewData.ModelState[nameof(RemoveRegistrationPromptViewModel.Confirm)]?.Errors?.Count > 0;
  var confirmFormErrorClass = confirmError ? "nhsuk-form-group--error" : "";
}

@section NavMenuItems {
  <partial name="~/Views/TrackingSystem/Shared/_NavMenuItems.cshtml" />
}

@if (errorHasOccurred) {
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
      <vc:error-summary order-of-property-names="@new []{ nameof(RemoveRegistrationPromptViewModel.Confirm) }" />
    </div>
  </div>
}

<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-full">
    <h1 class="nhsuk-heading-xl">Remove delegate registration prompt</h1>
  </div>
</div>

<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-one-quarter nhsuk-heading-l">
    <div class="nhsuk-u-font-weight-bold">
      Prompt:
    </div>
  </div>
  <div class="nhsuk-grid-column-three-quarters nhsuk-heading-l nhsuk-u-font-weight-normal">
    @Model.PromptName
  </div>
</div>

<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-full nhsuk-body-m">
    @if (Model.DelegateCount == 1) {
      <p>@Model.DelegateCount user has responded to this prompt. Deleting the prompt will permanently delete their response.</p>
    } else {
      <p>@Model.DelegateCount users have responded to this prompt. Deleting the prompt will permanently delete all of their responses.</p>
    }
  </div>
</div>

<form class="nhsuk-u-margin-bottom-8" method="post" asp-action="RemoveRegistrationPrompt">
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
      <div class="nhsuk-form-group @confirmFormErrorClass">
        <fieldset class="nhsuk-fieldset" aria-describedby="confirm-error">
          @if (confirmError) {
            <span class="nhsuk-error-message" id="confirm-error">
              <span class="nhsuk-u-visually-hidden">Error:</span> @ViewData.ModelState[nameof(RemoveRegistrationPromptViewModel.Confirm)].Errors[0].ErrorMessage
            </span>
          }
          <div class="nhsuk-checkboxes">
            <div class="nhsuk-checkboxes__item">
              <input class="nhsuk-checkboxes__input" id="confirm" name="confirm" asp-for="Confirm" />
              <label class="nhsuk-label nhsuk-checkboxes__label" for="confirm">
                @if (Model.DelegateCount == 1) {
                  @:I am sure that I wish to delete this prompt and @Model.DelegateCount delegate response
                } else {
                  @:I am sure that I wish to delete this prompt and all @Model.DelegateCount delegate responses
                }
              </label>
            </div>
          </div>
        </fieldset>
      </div>
      <input type="hidden" asp-for="PromptName" />
      <input type="hidden" asp-for="DelegateCount" />
      <button class="nhsuk-button delete-button nhsuk-button--secondary" type="submit">Delete prompt</button>
    </div>
  </div>
</form>

<div class="nhsuk-grid-row">
  <div class="nhsuk-grid-column-full">
    <vc:back-link asp-controller="RegistrationPrompts" asp-action="Index" link-text="Cancel" />
  </div>
</div>
